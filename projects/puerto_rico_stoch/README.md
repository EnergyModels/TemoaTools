Instructions to create the temoa-stoch-py2 environment and run the puerto_rico_stoch project
-

1) Creating python environment for temoa_stochastic
    0) Prerequisites: python 2.7 using Anaconda2
        - https://www.anaconda.com/distribution/#download-section
    2) Download temoatools
        - https://www.github.com/EnergyModels/temoatools
    2) Create temoa-stoch-py2 environment within anaconda 2
        - start anaconda
        - move to temoa_stochastic directory
        - create and activate environment using environment.yml
    3) Install modified version of Pyomo (Details of modifications are in pyomo_instructions.txt)
        - move to pyomo directory
        - install pyomo
    3) Install temoatools
        - move to temoatools directory
        - install temoatools

    Sample commands for running on Rivanna, UVA's high performance computing system*:
    
    >
        git clone https://www.github.com/EnergyModels/temoatools
        module load anaconda/2019.10-py2.7
        cd temoatools/temoa_stochastic
        conda env create
        source activate temoa-stoch-py2
        cd pyomo
        pip install .
        cd ../..
        pip install .

2) Running puerto_rico_stoch project
    1) Option 1: Using shell scripts (recommended):
        - start terminal and move to temoatools/projects/puerto_rico_stoch directory
        - Run pre_processing.sh
        - Run run_all_simulations.sh (generated by pre_processing as an executable, each simulation takes ~12 hours)
        - Run post_processing.sh
    
    Sample commands for running on Rivanna*:
    
    >
        cd temoatools/projects/puerto_rico_stoch
        sbatch run_pre_processing.sh
        ./run_all_simulations.sh
        sbatch run_post_processing.sh
        
    2) Option 2: Running files individually
        1) start terminal and load anaconda2
        2) load temoa-stoch-py2 environment
        3) load gurobi
        4) move to temoatools/projects/puerto_rico_stoch directory
        5) Pre-processing
            1) run stochastics_baselines.py
            2) run stochastics_write_input_files.py
        6) Perform temoa simulations (these steps will need to be repeated for each scenario, commands below are for AA_0)
            1) create scenario tree
            2) rewrite tree nodes (accounts for cumulative damage over multiple time periods)
            3) run simulation
        7) Perform post_processing
            4) run stochastics_analyze_baseline.py
            4) run stochastics_analyze_all.py
    
    Sample commands for running on Rivanna*:
    
    >
        module load anaconda/2019.10-py2.7
        source activate temoa-stoch-py2
        export PYTHONPATH=$EBROOTGUROBI/lib/python2.7_utf32
        module load gurobi/9.0.1
        
        cd temoatools/temoa_stochastic
        python stochastics_baselines.py
        python stochastics_write_input_files.py
        
        cd ../../temoa_stochastic/tools
        python generate_scenario_tree_JB.py options/stoch_AA_0.py --debug
        python rewrite_tree_nodes.py options/stoch_AA_0.py --debug
        
        cd ..
        python temoa_model/temoa_stochastic.py --config=configs/config_stoch_AA_0.txt
                
        cd ../projects/puerto_rico_stoch
        python stochastics_analyze_baseline.py
        python stochastics_analyze_all.py

## Notes:
*At the time of writing this, Rivanna has python 2.7, Anaconda2 and Gurobi installed.
However, modules on Rivanna are routinely updated. 
Therefore "module load" commands (for anaconda and gurobi) may need to be updated. 
Check https://www.rc.virginia.edu/userinfo/rivanna/software/modules/ for the latest.

#### Helpful commands for Rivanna:
- pwd - list present working directory
- ls - list contents of current directory
- sacct - list currently running slurm jobs
- scancel # - cancel job #